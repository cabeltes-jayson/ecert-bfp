{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            align-items: center;
        }
        
        /* MAIN CONTAINER */
        .container {
            display: flex;
        }

        .left-box, .right-box {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* LEFT BOX ELEMENTS */
        .left-box {
            flex: 2;
            display: flex;
            flex-direction: column;
        }

        .certificate-page {
            background-color: white;
            width: 100%;
            margin-bottom: 20px; /* space between pages */
            position: relative;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .logo-container img {
            height: 70px;
            width: 70px;
        }

        .logo-container #emblem {
            height: 70px;
            width: 70px;
            margin-right: 30px;
        }

        .titles {
            display: block; /* Ensure the titles are visible */
            text-align: center;
            margin: 0;
            color: black;
        }

        .titles p, .bold-title {
            font-size: 13px;
            text-align: center;
            margin: 0;
            line-height: 1;
            color: black;
        }

        .titles .bigger-font {
            font-size: 17px;
        }

        .titles .bold-title {
            font-weight: bold;
        }

        .titles span {
            text-decoration: underline; 
            color: blue;
        }

        /* mao ning CERTIFICATION */
        @font-face {
            font-family: 'Eras Bold ITC';
            src: url("{% static 'fonts/eras-bold-itc.ttf' %}") format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        #certificate-title {
            font-size: 25px;
            text-align: center;
            font-weight: bold;
            font-family: 'Eras Bold ITC', sans-serif;
            margin-top: 30px;
            margin-right: 0;
            margin-bottom: 0;
            margin-left: 0;
            padding: 0;
        }

        .entered-forms {
            margin-top: 0;
            margin-left: 100px;
            margin-right: 100px;
            font-size: 17px;
            line-height: 1;
            overflow-wrap: anywhere;    /* Break long words when necessary */
            hyphens: none;
        }

        .entered-forms p, div {
            text-align: justify;
            font-family: Arial, sans-serif;
        }

        .signature {
            text-align: right; 
            margin-top: 50px;
            width: 100%;
        }

        .signature .signature-content {
            display: inline-block;
            text-align: center;
            line-height: 1;
            margin-right: 100px;
        }

        .signature .signature-content p {
            margin: 0;
            font-size: 17;
            font-weight: bold;
            font-family: Arial, sans-serif;
        }

        .signature .signature-content .signature-space {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .signature .signature-content strong p {
            border-top: 1px solid black; 
        }

        .footer img {
            width: 50%;
        }

        .footer {
            margin-top: 50%;
            text-align: center;
        }

        /* RIGHT BOX ELEMENTS */
        .right-box {
            display: flex;
            flex-direction: column;
            /* Make right-box sticky as you scroll */
            flex: 0 0 400px; /* Reserve a fixed width */
            position: sticky;
            top: 0;
            right: 0;
            background: #fff;
            border-left: 1px solid #ccc;
            height: 100vh;
            overflow-y: auto;
        }
        
        .forms-rightbox {
            display: flex;
            flex: 2;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .button-rightbox {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .button-rightbox button,
        .button-rightbox a {
            flex: 1 1 45%;
        }
        
        .button-rightbox button {
            width: 50%;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .button-rightbox button:hover {
            background: #0056b3;
        }

        .button-rightbox a {
            display: inline-block;
            width: 50%;
            text-decoration: none;
        }

        .button-rightbox a button {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .button-rightbox a button:hover {
            background: #a71d2a;
        }

        #clear-form {
            background: #ffa500;
            transition: background 0.3s ease;
        }

        #clear-form:hover {
            background: #bb7900;
        }

        .certificate-forms {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .certificate-forms h3 {
            text-align: center;
            color: black;
            font-size: 20px;
        }

        .certificate-forms form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .certificate-forms form input,
        .certificate-forms form textarea {
            width: 90%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .certificate-forms button {
            padding: 8px 15px;
            font-size: 14px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .certificate-forms button:hover {
            background: #0056b3;
        }
        
        /* OTHER */

        #personnel-container-wrapper {
            max-height: 150px; /* adjust as needed */
            overflow-y: auto;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .personnel-input {
            display: flex;
            align-items: baseline; /* Aligns the text baseline of the input and button */
            gap: 5px;
        }

        .remove-page-btn {
            position: absolute;
            top: 10px;
            right: 50px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            background-color: rgba(255, 0, 0, 0.5); /* Transparent red */
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .remove-page-btn:hover {
            background-color: red; /* Solid red on hover */
        }

        /* PRINT */
        @media print {
            @page {
                size: auto;
                margin: 0;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            
            html, body {
                margin: 0;
                padding: 0;
            }
            
            .right-box {
                display: none;
            }

            .certificate-page {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                page-break-after: always;
                width: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }

            .certificate-page:last-child {
                page-break-after: auto; /* Do not force break after last page */
            }

            .remove-page-btn {
                display: none;
            }

            .edit-overlay {
                display: none;
            }

            .footer {
                position: relative;
                margin-top: auto;
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="left-box" class="left-box">
            <div class="certificate-page" data-cert-type="default">
                <div class="header">
                    <div class="logo-container">
                        <img src="{% static 'images/logo-bfp.png' %}" alt="BFP_Logo">
                        <img src="{% static 'images/logo-bp.png' %}" alt="BFP_Logo">
                        <img id="emblem" src="{% static 'images/logo-emblem.png' %}" alt="BFP_Logo">
                    </div>
        
                    <div class="titles">
                        <p>Republic of the Philippines</p>
                        <p>Department of Interior and Local Government</p>
                        <p class="bold-title">BUREAU OF FIRE PROTECTION</p>
                        <p class="bold-title">REGION 10</p>
                        <p class="bigger-font">CAGAYAN DE ORO FIRE DISTRICT OFFICE</p>
                        <p class="bigger-font">Capt. Vicente Roa St., Cagayan de Oro City</p>
                        <p class="bigger-font">Email Add: <span>cofdpersec24v@gmail.com</span></p>
                    </div>
                </div>

                <h2 id="certificate-title"></h2>
        
                <p class="entered-forms"></p>
        
                <div class="signature">
                    <div class="signature-content">
                        <p>REXCLIBURN L SALVAÑA</p>
                        <p class="signature-space">
                            <span>SSUPT</span>
                            <span>(DSC)</span>
                            <span>BFP</span>
                        </p>
                        <strong><p>District Fire Marshal</p></strong>
                    </div>
                </div>
        
                <div class="footer">
                    <img src="{% static 'images/bfp-footer.png' %}" alt="BFP_Footer">
                </div>
            </div>
        </div>
    
        <div class="right-box">
            <div id="forms-rightbox">
                <div class="certificate-forms">
                    {% block certificate-forms %}{% endblock %}
                </div>

                <div class="button-rightbox">
                    <button onclick="addPage()">Add Page</button>
                    <button onclick="printCert()">Print</button>
                    <button id="clear-form">Clear Form</button>
                    <a href="{% url 'dashboard' %}"><button>Go Back</button></a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // !! SAVEPOINT 6.0
        // !! READ !!
        // Global variable to track which certificate page is currently being edited.
        window.currentEditingPage = null;
        
        // VOWELS helper – used in OJT branch.
        function getArticle(word) {
            const vowels = ['a', 'e', 'i', 'o', 'u'];
            return vowels.includes(word[0].toLowerCase()) ? 'an' : 'a';
        }
        
        // DATE NEW!!!!
        function formatDate(inputDate, withSuffix = false, html = true) {
            if (!inputDate) return html ? "________" : "________";
            let date = new Date(inputDate);
            let day = date.getDate();
            let month = date.toLocaleString("en-GB", { month: "long" });
            let year = date.getFullYear();

            function getOrdinalSuffix(n) {
                if (n > 3 && n < 21) return "th";
                switch (n % 10) {
                    case 1: return "st";
                    case 2: return "nd";
                    case 3: return "rd";
                    default: return "th";
                }
            }

            if (withSuffix) {
                if (html) {
                    return `<strong><i><u>${day}<sup>${getOrdinalSuffix(day)}</sup></u></i></strong> day of <strong><i><u>${month}</u></i></strong> <strong><i><u>${year}</u></i></strong>`;
                } else {
                    return `${day}${getOrdinalSuffix(day)} day of ${month} ${year}`;
                }
            } else {
                return `${day} ${month} ${year}`;
            }
        }
        
        // clearForm: Clears form fields and localStorage values for the current certificate type.
        function clearForm() {
            const certType = localStorage.getItem("certType");
            if (certType === "internship") {
                document.getElementById("studentName").value = "";
                document.getElementById("course").value = "";
                document.getElementById("school").value = "";
                document.getElementById("render_time").value = "";
                document.getElementById("date_started").value = "";
                document.getElementById("date_ended").value = "";
                document.getElementById("date_issued").value = "";
                localStorage.setItem("studentName", "");
                localStorage.setItem("course", "");
                localStorage.setItem("school", "");
                localStorage.setItem("render_time", "");
                localStorage.setItem("date_started", "");
                localStorage.setItem("date_ended", "");
                localStorage.setItem("date_issued", "");
            } else if (certType === "app") {
                document.getElementById("station").value = "";
                document.getElementById("purpose").value = "";
                document.getElementById("duration").value = "";
                document.getElementById("date_issued").value = "";
                localStorage.setItem("station", "");
                localStorage.setItem("purpose", "");
                localStorage.setItem("duration", "");
                localStorage.setItem("date_issued", "");
                localStorage.setItem("personnel", "");
                const personnelContainer = document.getElementById("personnel-container");
                if (personnelContainer) {
                    personnelContainer.innerHTML = `<div class="personnel-input">
                        <input type="text" class="personnel" placeholder="Enter Personnel">
                        <button type="button" class="add-personnel">+</button>
                    </div>`;
                }
            }
        }

        document.getElementById("clear-form").addEventListener("click", function() {
            clearForm();
            updateCertificate();  // update the certificate preview after clearing
        });

        // updateCertificate:
        // Reads form values (depending on certType) and updates the currently editing certificate page.
        function updateCertificate() {
            // Ensure a certificate page is selected. If not, default to the first one.
            let page = window.currentEditingPage;
            if (!page) {
                page = document.querySelector(".certificate-page");
                window.currentEditingPage = page;
            }
            const certType = localStorage.getItem("certType"); // "ojt" or "app"
            let certificateTitle = "";
            let certText = "";
        
            if (certType === "internship") {
                certificateTitle = "CERTIFICATION";
                // Read OJT fields.
                let studentName = document.getElementById("studentName").value || "________";
                let course = document.getElementById("course").value || "________";
                let school = document.getElementById("school").value || "________";
                let render_time = document.getElementById("render_time").value || "________";
                let date_started = formatDate(document.getElementById("date_started").value, false, false);
                let date_ended = formatDate(document.getElementById("date_ended").value, false, false);
                let date_issued = formatDate(document.getElementById("date_issued").value, true, true);
                let article = getArticle(course);
        
                certText = `<p style="text-indent: 50px;"><strong>THIS IS TO CERTIFY</strong> that <strong>${studentName}</strong>, ${article} <strong>${course}</strong> student from <strong>${school}</strong>, rendered On-the-Job Training (OJT) for <strong>${render_time}</strong> hours in this office from <strong>${date_started}</strong> – <strong>${date_ended}</strong>.</p>
                            <p style="text-indent: 50px;">This certification is being issued for whatever purpose it may serve.</p>
                            <p style="text-indent: 50px;">Issued this ${date_issued} at the <strong>Office of the District Fire Marshal,</strong> Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de oro City.</p>`;
        
                // Save values in the page dataset.
                page.dataset.studentName = studentName === "________" ? "" : studentName;
                page.dataset.course = course === "________" ? "" : course;
                page.dataset.school = school === "________" ? "" : school;
                page.dataset.render_time = render_time === "________" ? "" : render_time;
                page.dataset.date_started = document.getElementById("date_started").value;
                page.dataset.date_ended = document.getElementById("date_ended").value;
                page.dataset.date_issued = document.getElementById("date_issued").value;
        
            } else if (certType === "app") {
                certificateTitle = "CERTIFICATE OF APPEARANCE";
                // Read Appearance fields.
                let station = document.getElementById("station").value || "________";
                let purpose = document.getElementById("purpose").value || "________";
                let duration = formatDate(document.getElementById("duration").value, false, false);
                let date_issued = formatDate(document.getElementById("date_issued").value, true, true);
        
                // Get personnel values from the personnel container.
                let personnelInputs = document.querySelectorAll("#personnel-container .personnel");
                let personnelArray = Array.from(personnelInputs)
                    .map(input => input.value.trim())
                    .filter(val => val !== "");
                let personnelText = personnelArray.join("<br>") || "________";
                // Adjust font-size based on number of personnel.
                let baseFontSize = 17;
                let fontSize = baseFontSize;
                if (personnelArray.length > 7 && personnelArray.length <= 10) {
                    fontSize = baseFontSize - (personnelArray.length - 7);
                } else if (personnelArray.length > 10) {
                    fontSize = baseFontSize - 5;
                }
                if (fontSize < 10) fontSize = 10;
        
                certText = `<p style="text-indent: 50px;"><strong>THIS IS TO CERTIFY</strong> that the following personnel of <strong>${station}</strong> appeared to this office purposely to <strong>${purpose}</strong> on <strong>${duration}</strong> at <strong>Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City</strong>, to wit:</p>
                            <p style="font-size: ${fontSize}px;"><strong><center>${personnelText}</center></strong></p>
                            <p style="text-indent: 50px;">This certification is being issued for whatever purpose it may serve.</p>
                            <p style="text-indent: 50px;">Issued this <strong>${date_issued}</strong> at the <strong>Office of the District Fire Marshal,</strong> Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City.</p>`;
        
                // Save Appearance fields into the page dataset.
                page.dataset.station = station === "________" ? "" : station;
                page.dataset.purpose = purpose === "________" ? "" : purpose;
                page.dataset.duration = document.getElementById("duration").value;
                page.dataset.date_issued = document.getElementById("date_issued").value;
                page.dataset.personnel = personnelArray.join("\n");
            }
        
            // Update the certificate page's preview.
            page.querySelector("#certificate-title").innerText = certificateTitle;
            page.querySelector(".entered-forms").innerHTML = certText;
        }
        
        /**
         * loadFormDataFromPage(page):
         * Loads stored data from a certificate page into the form fields.
         * Works for both "ojt" and "app".
         */
        function loadFormDataFromPage(page) {
            window.currentEditingPage = page;
            const certType = localStorage.getItem("certType");
            if (certType === "internship") {
                document.getElementById("studentName").value = 
                    page.dataset.studentName && page.dataset.studentName !== "________" 
                    ? page.dataset.studentName 
                    : "";
                document.getElementById("course").value = 
                    page.dataset.course && page.dataset.course !== "________" 
                    ? page.dataset.course 
                    : "";
                document.getElementById("school").value = 
                    page.dataset.school && page.dataset.school !== "________" 
                    ? page.dataset.school 
                    : "";
                document.getElementById("render_time").value = 
                    page.dataset.render_time && page.dataset.render_time !== "________" 
                    ? page.dataset.render_time 
                    : "";
                document.getElementById("date_started").value = page.dataset.date_started || "";
                document.getElementById("date_ended").value = page.dataset.date_ended || "";
                document.getElementById("date_issued").value = page.dataset.date_issued || "";
            } else if (certType === "app") {
                document.getElementById("station").value = 
                    page.dataset.station && page.dataset.station !== "________" 
                    ? page.dataset.station 
                    : "";

                document.getElementById("purpose").value = 
                    page.dataset.purpose && page.dataset.purpose !== "________" 
                    ? page.dataset.purpose 
                    : "";
                document.getElementById("duration").value = page.dataset.duration || "";
                document.getElementById("date_issued").value = page.dataset.date_issued || "";
        
                // Update personnel container.
                const personnelContainer = document.getElementById("personnel-container");
                personnelContainer.innerHTML = "";
                let personnelData = page.dataset.personnel || "";
                let personnelArray = personnelData.split("\n").filter(line => line.trim() !== "");
                if (personnelArray.length === 0) {
                    // No personnel data: add one default input (without remove button).
                    const div = document.createElement("div");
                    div.classList.add("personnel-input");
                    div.innerHTML = `
                        <input type="text" class="personnel" placeholder="Enter Personnel">
                        <button type="button" class="add-personnel">+</button>
                    `;
                    personnelContainer.appendChild(div);
                } else {
                    personnelArray.forEach((person, idx) => {
                        const div = document.createElement("div");
                        div.classList.add("personnel-input");
                        if (idx === 0) {
                            // First input: no remove button.
                            div.innerHTML = `
                                <input type="text" class="personnel" placeholder="Enter Personnel" value="${person}">
                                <button type="button" class="add-personnel">+</button>
                            `;
                        } else {
                            div.innerHTML = `
                                <input type="text" class="personnel" placeholder="Enter Personnel" value="${person}">
                                <button type="button" class="remove-personnel">-</button>
                            `;
                        }
                        personnelContainer.appendChild(div);
                    });
                }
            }
        }
        
        // Listen for input events in the top-right box to update the current certificate page.
        document.getElementById("forms-rightbox").addEventListener("input", function(e) {
            if (e.target.tagName === "INPUT") {
                if (e.target.classList.contains("personnel")) {
                    updateAllPersonnel();
                } else {
                    updateCertificate();
                }
            }
        });
        
        // updateAllPersonnel: Combines personnel inputs and updates the certificate.
        function updateAllPersonnel() {
            const personnelInputs = document.querySelectorAll("#personnel-container .personnel");
            const combined = Array.from(personnelInputs)
                .map(input => input.value.trim())
                .filter(val => val !== "")
                .join("\n");
            localStorage.setItem("personnel", combined);
            updateCertificate();
        }
        
        // Dynamic personnel add/remove delegation.
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('add-personnel')) {
                const personnelContainer = event.target.closest('#personnel-container');
                const newPersonnelInput = document.createElement('div');
                newPersonnelInput.classList.add('personnel-input');
                newPersonnelInput.innerHTML = `
                    <input type="text" class="personnel" placeholder="Enter Personnel">
                    <button type="button" class="remove-personnel">-</button>
                `;
                personnelContainer.appendChild(newPersonnelInput);
                updateAllPersonnel();
            }
            if (event.target.classList.contains('remove-personnel')) {
                const personnelContainer = event.target.closest('#personnel-container');
                if (personnelContainer.querySelectorAll(".personnel").length > 1) {
                    event.target.parentElement.remove();
                    updateAllPersonnel();
                }
            }
        });
        
        // Helper: Returns the default certificate layout for appearance certificates.
        function getDefaultAppContent() {
            return `<p style="text-indent: 50px;"><strong>THIS IS TO CERTIFY</strong> that the following personnel of <strong>________</strong> appeared to this office purposely to <strong>________</strong> on <strong>________</strong> at <strong>Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City</strong>, to wit:</p>
                    <p style="font-size: 17px;"><strong><center>________</center></strong></p>
                    <p style="text-indent: 50px;">This certification is being issued for whatever purpose it may serve.</p>
                    <p style="text-indent: 50px;">Issued this <strong>________</strong> at the <strong>Office of the District Fire Marshal,</strong> Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City.</p>`;
        }
        
        // addPage: Creates a new certificate page using default layout based on certType.
        function addPage() {
            // First, clear the form so that new page gets blank/default values.
            clearForm();
        
            const pagesContainer = document.getElementById('left-box');
            const newPage = document.createElement('div');
            newPage.classList.add('certificate-page');
            newPage.style.position = "relative"; // For overlay positioning
            newPage.setAttribute("data-cert-type", "default");
        
            const certType = localStorage.getItem("certType");
            let defaultContent = "";
            if (certType === "app") {
                defaultContent = getDefaultAppContent();
            } else if (certType === "internship") {
                // Define a default OJT layout if desired.
                defaultContent = `<p style="text-indent: 50px;"><strong>THIS IS TO CERTIFY</strong> that <strong>________</strong> rendered OJT in this office.</p>
                                  <p style="text-indent: 50px;">This certification is being issued for whatever purpose it may serve.</p>
                                  <p style="text-indent: 50px;">Issued this <strong>________</strong> at the <strong>Office of the District Fire Marshal,</strong> Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de oro City.</p>`;
            }
        
            // Create the new page with an empty entered-forms container.
            newPage.innerHTML = `
                <div class="edit-overlay" style="position:absolute; top:0; left:0; background: rgba(255,255,255,0.5); padding:5px; cursor:pointer; z-index:100;">
                    CLICK PAGE TO EDIT!
                </div>
                <button class="remove-page-btn" onclick="removePage(this)">Remove</button>
                <div class="header">
                    <div class="logo-container">
                        <img src="{% static 'images/logo-bfp.png' %}" alt="BFP_Logo">
                        <img src="{% static 'images/logo-bp.png' %}" alt="BFP_Logo">
                        <img id="emblem" src="{% static 'images/logo-emblem.png' %}" alt="BFP_Logo">
                    </div>
        
                    <div class="titles">
                        <p>Republic of the Philippines</p>
                        <p>Department of Interior and Local Government</p>
                        <p class="bold-title">BUREAU OF FIRE PROTECTION</p>
                        <p class="bold-title">REGION 10</p>
                        <p class="bigger-font">CAGAYAN DE ORO FIRE DISTRICT OFFICE</p>
                        <p class="bigger-font">Capt. Vicente Roa St., Cagayan de Oro City</p>
                        <p class="bigger-font">Email Add: <span>cofdpersec24v@gmail.com</span></p>
                    </div>
                </div>
        
                <br><br>
                <h2 id="certificate-title"></h2>
        
                <p class="entered-forms"></p>
        
                <div class="signature">
                    <div class="signature-content">
                        <p>REXCLIBURN L SALVAÑA</p>
                        <p class="signature-space">
                            <span>SSUPT</span>
                            <span>(DSC)</span>
                            <span>BFP</span>
                        </p>
                        <strong><p>District Fire Marshal</p></strong>
                    </div>
                </div>
        
                <div class="footer">
                    <img src="{% static 'images/bfp-footer.png' %}" alt="BFP_Footer">
                </div>
            `;
        
            pagesContainer.appendChild(newPage);
        
            // Bind click events for editing.
            const overlay = newPage.querySelector('.edit-overlay');
            overlay.addEventListener('click', function(e) {
                e.stopPropagation();
                loadFormDataFromPage(newPage);
            });
            newPage.addEventListener('click', function(e) {
                e.stopPropagation();
                loadFormDataFromPage(newPage);
            });
        
            // After appending, set currentEditingPage to newPage and update its preview.
            window.currentEditingPage = newPage;
            updateCertificate();
        }
        
        // removePage: Removes a certificate page.
        function removePage(button) {
            const page = button.parentElement;
            const pagesContainer = document.getElementById('left-box');
            pagesContainer.removeChild(page);
        }
        
        // printCert: Triggers window.print().
        function printCert() {
            window.print();
        }
        
        // Initialize certificate preview on page load.
        document.addEventListener("DOMContentLoaded", function() {
            // Bind click events to existing certificate pages.
            document.querySelectorAll(".certificate-page").forEach(cert => {
                cert.addEventListener("click", function(e) {
                    e.stopPropagation();
                    loadFormDataFromPage(this);
                });
            });
            // Default to the first certificate page if none is selected.
            if (!window.currentEditingPage) {
                window.currentEditingPage = document.querySelector(".certificate-page");
            }
            updateCertificate();
            window.updateAllPersonnel = updateAllPersonnel;
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
