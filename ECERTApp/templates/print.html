{% extends "base.html" %}

{% block title %}PRINT CERTIFICATE{% endblock %}

{% block content %}
    <!-- STYLES -->
    <style>
        .print {
            display: flex;
            height: 100vh;
        }

        .preview {
            flex: 2;
            border: 2px solid black;
            padding: 20px;
            margin: 10px;
            background: #f8f9fa;
        }

        .buttons {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        button {
            font-size: 16px;
            cursor: pointer;
        }
        #prev-header {
            text-align: center;
        }
    </style>

    <!-- BODY -->
    <div class="print">
        <div class="preview">
            <h2 id="prev-header">Certificate Preview</h2>
            <p id="entered-credentials"></p>
        </div>

        <div class="buttons">
            <button onclick="printCert()">Print</button>
            <button>Download</button>
            <button>Cancel</button>
        </div>
    </div>

    <!-- Prev page -->
    <a href="{% url 'dashboard' %}"><button>Go Back</button></a>

    <br><br>

    <!-- Temporary Logout -->
    <a href="{% url 'home' %}"><button>Logout</button></a>

    <!-- SCRIPTS -->
    <script>
        // CERTS
        document.addEventListener("DOMContentLoaded", function () {

        function formatDate(inputDate, withSuffix = false) {
            if (!inputDate) return "________";

            let date = new Date(inputDate);
            let day = date.getDate();
            let month = date.toLocaleString("en-GB", { month: "long" });
            let year = date.getFullYear();

            if (withSuffix) {
                function getOrdinalSuffix(n) {
                    if (n > 3 && n < 21) return "th"; // Covers 11th to 20th
                    switch (n % 10) {
                        case 1: return "st";
                        case 2: return "nd";
                        case 3: return "rd";
                        default: return "th";
                    }
                }
                return `${day}${getOrdinalSuffix(day)} of ${month} ${year}`;
            } else {
                return `${day} ${month} ${year}`;
            }
        }
        
            let certType = localStorage.getItem("certType");

            let certText = "";

            if (certType === "ojt") {
                let studentName = localStorage.getItem("studentName") || "________";
                // let venue = localStorage.getItem("venue") || "________";
                let course = localStorage.getItem("course") || "________";
                let school = localStorage.getItem("school") || "________";
                let renderTime = localStorage.getItem("renderTime") || "________";
                let dateStarted = formatDate(localStorage.getItem("dateStarted"), false);
                let dateEnded = formatDate(localStorage.getItem("dateEnded"), false);
                let dateIssued = formatDate(localStorage.getItem("dateIssued"), true);

                certText = `THIS IS TO CERTIFY that 
                <strong>${studentName}</strong>, an 
                <strong>${course}</strong> student from 
                <strong>${school}</strong>, rendered On-the-Job Training (OJT) for 
                <strong>${renderTime}</strong> in this office from 
                <strong>${dateStarted}</strong> â€“ <strong>${dateEnded}</strong>.<br><br>
                This certification is being issued for whatever purpose it may serve.<br><br>
                Issued this <strong>${dateIssued}</strong> at the Office of the District Fire Marshal, 
                Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City.`;
            }

            if (certType === "app") {
                let station = localStorage.getItem("station") || "________";
                let purpose = localStorage.getItem("purpose") || "________";
                
                let personnel = (localStorage.getItem("personnel") || "________").replace(/\n/g, "<br>");
                // let personnel = localStorage.getItem("personnel") || "________";
                
                let duration = formatDate(localStorage.getItem("duration"), false);
                let dateIssued = formatDate(localStorage.getItem("dateIssued"), true);

                certText = `THIS IS TO CERTIFY that the following personnel of  
                <strong>${station || "________"}</strong> appeared to this office purposely to  
                <strong>${purpose || "________"}</strong> on  
                <strong>${duration || "________"}</strong> at <strong>Cagayan de Oro Fire District, 
                    Captain Vicente Roa St., Cagayan de Oro City</strong>, to wit:<br><br>  
                <strong>${personnel || "________"}</strong><br><br>  
                This certification is being issued for whatever purpose it may serve.<br><br>  
                Issued this <strong>${dateIssued || "________"}</strong> at the Office of the District Fire Marshal,  
                Cagayan de Oro Fire District, Captain Vicente Roa St., Cagayan de Oro City.`;
            }

            document.getElementById("entered-credentials").innerHTML = certText;
        });

        function printCert() {
            window.print();
        }

    </script>
{% endblock %}
